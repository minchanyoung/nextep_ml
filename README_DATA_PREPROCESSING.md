# 머신러닝을 위한 데이터 전처리 보고서

## 📋 프로젝트 개요

본 프로젝트는 한국노동연구원의 KLIPS(한국노동패널조사) 데이터를 활용하여 **개인의 다음 연도 임금(p_wage)과 직업만족도(p4321)를 예측**하는 머신러닝 모델 개발을 목표로 합니다.

### 🎯 예측 목표
- **주 타겟**: `p_wage` (다음 연도 임금)
- **부 타겟**: `p4321` (다음 연도 직업만족도)

---

## 📊 원본 데이터 분석

### 데이터 기본 정보
- **파일명**: `nextep_dataset.csv`
- **전체 크기**: 369,307개 관측값
- **개인 수**: 35,976명
- **시간 범위**: 2000년~2023년 (24년간)
- **웨이브 범위**: 3~26차

### 주요 변수 구조

| 변수명 | 설명 | 데이터 타입 | 결측값 비율 |
|--------|------|-------------|-------------|
| `pid` | 개인 고유 ID | int64 | 0% |
| `year` | 조사 연도 | int64 | 0% |
| `p_age` | 개인 연령 | int64 | 0% |
| `p_edu` | 교육수준 (1-6) | float64 | 0.01% |
| `p_sex` | 성별 (1=남성, 2=여성) | int64 | 0% |
| `p_wage` | **임금 (만원)** | float64 | **48.8%** |
| `p4321` | **직업만족도 (1-5)** | float64 | **44.8%** |
| `p_ind200X` | 산업분류 코드 | float64 | 44-60% |

---

## 🔍 탐색적 데이터 분석 결과

### 1. 타겟 변수 분석

#### 임금 (p_wage) 분포
- **평균**: 234.7만원
- **중위수**: 200만원
- **범위**: 0~30,000만원 (상위 1% 캡핑 후: ~900만원)
- **연도별 증가 추세**: 2000년 117만원 → 2023년 304만원

#### 직업만족도 (p4321) 분포
- **평균**: 2.72점 (5점 척도)
- **분포**: 주로 2-3점에 집중 (보통~만족)
- **시간 변화**: 전반적으로 하락 추세 (3.03 → 2.59)
- **특이사항**: -1값(무응답) 747개 → 결측값 처리

### 2. 패널 데이터 특성

#### 관측 패턴
- **개인별 평균 관측 수**: 10.3년
- **최대 관측 기간**: 24년 (전 기간 참여)
- **연속 관측자**: 25,650명 (71%)
- **비연속 관측자**: 10,326명 (29%)

#### 예측 가능성
- **연속된 연도 관측 쌍**: 318,500개
- **임금 예측 가능**: 167,073개
- **만족도 예측 가능**: 179,987개
- **둘 다 예측 가능**: 166,507개

---

## 🔧 데이터 전처리 과정

### 1단계: 기본 데이터 정제
```python
# 중복값 제거
df_clean = df.drop_duplicates(subset=['pid', 'year'])

# 특이값 처리
df_clean.loc[df_clean['p4321'] == -1, 'p4321'] = np.nan  # -1을 결측값으로

# 극값 처리 (상위 1% 캡핑)
wage_99 = df_clean['p_wage'].quantile(0.99)  # 900만원
df_clean['p_wage'] = df_clean['p_wage'].clip(upper=wage_99)
```

### 2단계: 예측용 데이터셋 생성
- **연속된 연도 쌍 식별**: t년도 → t+1년도 관측이 있는 케이스만 선별
- **시프트 연산 활용**: `groupby('pid').shift(-1)`로 다음 연도 타겟 생성
- **최종 예측 데이터**: 166,507개 샘플

### 3단계: 특성 엔지니어링 (33개 특성 생성)

#### A. 기본 개인 특성 (5개)
- `p_age`: 나이
- `p_sex`: 성별
- `p_edu`: 교육수준
- `experience_years`: 경력연차 (나이 - 22)
- `time_trend`: 시간 트렌드

#### B. 시계열 특성 (13개)
```python
# Lag features (1-2년)
'p_wage_lag_1', 'p_wage_lag_2'
'p4321_lag_1', 'p4321_lag_2' 
'p_age_lag_1', 'p_age_lag_2'

# 변화율
'wage_change_1y' = (현재임금 - 1년전임금) / 1년전임금
'satisfaction_change_1y' = 현재만족도 - 1년전만족도

# 이동평균 (3년)
'wage_ma_3y', 'satisfaction_ma_3y'
```

#### C. 상호작용 특성 (3개)
- `age_edu_interaction`: 나이 × 교육수준
- `wage_satisfaction_ratio`: 임금 / (만족도 + 1)
- `experience_wage_ratio`: 임금 / (경력 + 1)

#### D. 업종/직업 특성 (2개)
- `current_industry`: 최신 업종 코드
- `industry_changed`: 업종 변경 여부

#### E. 시간 기반 특성 (4개)
- `wave_sin`, `wave_cos`: 계절성 (웨이브 기반)
- `financial_crisis`: 2008-2009 금융위기 더미
- `covid_period`: 2020년 이후 코로나 더미

#### F. 개인별 통계 특성 (6개)
- `p_wage_mean`, `p_wage_std`, `p_wage_count`: 개인별 임금 통계
- `p4321_mean`, `p4321_std`, `p4321_count`: 개인별 만족도 통계

### 4단계: 결측값 처리
- **수치형 변수**: 중위수 대체
- **범주형 변수**: 최빈값 대체
- **최종 결측값**: 0개 (완전 제거)

### 5단계: 시간 기반 데이터 분할
- **훈련 데이터**: 2000-2020년 (143,113개, 85.9%)
- **테스트 데이터**: 2021-2022년 (23,394개, 14.1%)

---

## 📈 특성 중요도 분석

### 타겟 변수와 상관관계가 높은 상위 10개 특성

| 순위 | 특성명 | 상관계수 | 설명 |
|------|--------|----------|------|
| 1 | `wage_satisfaction_ratio` | 0.579 | 임금/만족도 비율 |
| 2 | `wage_ma_3y` | 0.573 | 3년 임금 이동평균 |
| 3 | `p_wage` | 0.570 | 현재 임금 |
| 4 | `p_wage_mean` | 0.555 | 개인별 평균 임금 |
| 5 | `p_wage_lag_1` | 0.514 | 1년 전 임금 |
| 6 | `p_wage_lag_2` | 0.470 | 2년 전 임금 |
| 7 | `satisfaction_ma_3y` | 0.418 | 3년 만족도 이동평균 |
| 8 | `p4321_mean` | 0.386 | 개인별 평균 만족도 |
| 9 | `p_wage_std` | 0.377 | 개인별 임금 변동성 |
| 10 | `p4321` | 0.376 | 현재 만족도 |

---

## 📁 최종 데이터셋 구조

### 생성된 파일 목록

#### 1. ML 데이터셋
- `ml_dataset_engineered.csv`: 전체 ML 데이터셋 (166,507 × 38)
- `train_engineered.csv`: 훈련용 데이터 (143,113개)
- `test_engineered.csv`: 테스트용 데이터 (23,394개)

#### 2. 중간 산출물
- `wage_prediction_clean.csv`: 임금 예측용 정제 데이터
- `satisfaction_prediction_clean.csv`: 만족도 예측용 정제 데이터
- `combined_prediction_clean.csv`: 통합 예측용 정제 데이터

#### 3. 메타데이터
- `feature_info_final.csv`: 전체 특성 상세 정보
- `prediction_sample.csv`: 예측 샘플 데이터

---

## 🚨 주요 이슈 및 고려사항

### 1. 높은 결측값 비율
- **임금**: 48.8% 결측 → 예측 샘플 수 제한
- **만족도**: 44.8% 결측 → 개인별 패턴 파악 어려움
- **대응방안**: 개인별 이력 기반 통계 특성 생성으로 보완

### 2. 불균형 패널 구조
- **문제**: 개인별 관측 기간이 상이 (1년~24년)
- **영향**: 장기 추적 개인 vs 단기 관측 개인의 예측 품질 차이
- **대응방안**: 개인별 관측 수(`p_wage_count`) 특성으로 가중치 고려

### 3. 시대적 변화
- **임금 상승**: 연평균 4.8% 증가 (인플레이션 효과)
- **만족도 하락**: 지속적 감소 추세
- **대응방안**: `time_trend`, 경제위기 더미 변수로 시대 효과 반영

### 4. 경제 충격 이벤트
- **2008-2009 금융위기**: `financial_crisis` 더미 변수
- **2020~ 코로나19**: `covid_period` 더미 변수

---

## 🎯 머신러닝 모델링 권고사항

### 1. 추천 모델
- **Random Forest**: 비선형 관계, 결측값 처리 우수
- **XGBoost**: 부스팅, 특성 중요도 해석 가능
- **LSTM/GRU**: 시계열 패턴 학습 (개인별 sequence)
- **패널 회귀**: 개인 고정효과 모델

### 2. 모델 평가
- **메트릭**: RMSE, MAE (임금), Accuracy, F1 (만족도)
- **교차검증**: 시간 기반 분할 (Time Series Split)
- **개인별 성능**: 관측 수별 성능 분석

### 3. 해석 가능성
- **SHAP values**: 예측 기여도 분석
- **특성 중요도**: 모델별 중요도 비교
- **부분 의존성 플롯**: 주요 변수 영향도

---

## 📊 데이터 품질 평가

### 강점
✅ **장기간 패널 데이터** (24년간)  
✅ **대규모 샘플** (35,976명)  
✅ **풍부한 개인 특성** (나이, 교육, 성별)  
✅ **시간 변화 추적 가능**  

### 한계점
⚠️ **높은 결측률** (타겟 변수 44-48%)  
⚠️ **불균형 관측** (개인별 참여 기간 상이)  
⚠️ **업종 정보 부족** (분류 코드만 제공)  
⚠️ **외부 경제지표 부재**  

---

## 🏗️ 직업 분류 통합 시스템 (4단계)

### 1단계: 원본 직업 코드 분석
- **산업 분류**: 328개 고유 코드 (p_ind2000/2007/2017)
- **직업 분류**: 252개 고유 코드 (p_jobfam2000/2007/2017)
- **커버리지**: 산업 85.9%, 직업 89.1%

### 2단계: 사용자 친화적 매핑
12개 주요 직업 그룹으로 통합:
- IT·정보통신, 금융·보험, 의료·보건, 교육, 공공행정
- 제조업, 건설·건축, 유통·판매, 운송·물류
- 음식·숙박, 농림어업, 미분류

### 3단계: 상세 매핑 테이블 구축
- **구체적 직업명**: 149개 세분화
- **API 구조**: JSON 기반 검색 인덱스 구축
- **매핑 파일**: occupation_mapping_api.json

### 4단계: 통합 시스템 구현
**19개 새로운 직업 관련 특성 생성**:
```python
# 기본 직업 특성
'current_industry', 'current_job', 'occupation_group', 
'occupation_subcategory', 'occupation_code'

# 직업 안정성 지표
'job_stability', 'job_changes', 'occupation_tenure', 
'years_since_job_change', 'occupation_prev', 'occupation_changed'

# 직업군별 임금 통계
'occupation_avg_wage', 'occupation_med_wage', 'occupation_std_wage',
'wage_vs_occupation_avg', 'wage_quartile_in_occupation'

# 직업군별 만족도 통계  
'occupation_avg_satisfaction', 'occupation_std_satisfaction'

# 스킬 레벨 분류
'skill_level' (high_skill/mid_skill/low_skill/unknown)
```

### 사용자 서비스 클래스
`UserOccupationService` 구현:
- `search_jobs()`: 키워드 기반 직업 검색
- `get_job_suggestions()`: 그룹별 직업 제안
- `predict_user_profile()`: 사용자 입력 → 모델 특성 변환

---

## 🤖 부스팅 모델 비교 실험

### 실험 설계
- **알고리즘**: XGBoost, CatBoost, LightGBM
- **데이터**: 통합 직업 특성 포함 최종 데이터셋
- **평가 지표**: RMSE, MAE, R² (임금), Accuracy (만족도)
- **훈련셋**: 129,199개, **테스트셋**: 21,342개

### 임금 예측 결과 (회귀)

| 모델 | 테스트 RMSE | 테스트 MAE | 테스트 R² |
|------|-------------|-------------|-----------|
| **CatBoost** ⭐ | **115.92** | **54.77** | **0.704** |
| LightGBM | 117.89 | 55.53 | 0.694 |
| XGBoost | 118.50 | 55.50 | 0.691 |

### 직무만족도 예측 결과 (분류)

| 모델 | 테스트 정확도 |
|------|---------------|
| **XGBoost** ⭐ | **0.694** |
| CatBoost | 0.693 |
| LightGBM | 0.692 |

### 특성 중요도 분석

#### 임금 예측 주요 특성
1. **p_wage** (현재 임금): 230.683
2. **p_age** (나이): 145.251  
3. **current_job** (직업코드): 127.330
4. **wage_quartile_in_occupation**: 80.546
5. **current_industry** (산업코드): 75.681

#### 만족도 예측 주요 특성
1. **current_industry** (산업코드): 521.825
2. **current_job** (직업코드): 399.344
3. **p_age** (나이): 391.801
4. **p_wage** (임금): 327.225
5. **wage_vs_occupation_avg**: 209.678

### 핵심 인사이트
- **임금 예측**: CatBoost가 최고 성능 (R²=0.704)
- **만족도 예측**: XGBoost가 미세한 우위 (Acc=0.694)
- **통합 직업 특성의 효과**: 직업 관련 변수들이 상위권 중요도 차지
- **현재 상태 의존성**: 현재 임금/나이가 가장 중요한 예측 인자

---

## 🔄 향후 개선 방안

### 1. 추가 특성 엔지니어링
- 지역별 경제 지표 결합
- 업종별 평균 임금 정보 활용 ✅ (완료)
- 개인 생애주기 특성 (결혼, 출산, 은퇴)

### 2. 고급 결측값 처리
- 다중 대체 (Multiple Imputation)
- 딥러닝 기반 대체 모델
- 패턴 기반 대체 전략

### 3. 앙상블 전략
- 시계열 모델 + 패널 모델 결합
- 개인별 맞춤 모델 개발
- 동적 가중 평균 앙상블

### 4. 모델 성능 향상
- **하이퍼파라미터 최적화**: GridSearch, Bayesian Optimization
- **앙상블 기법**: CatBoost(임금) + XGBoost(만족도) 조합
- **특성 선택**: 중요도 기반 특성 필터링
- **교차검증**: 시계열 기반 검증 전략 개선

---

## 📚 참고문헌 및 데이터 출처

- **데이터 출처**: 한국노동연구원 KLIPS (한국노동패널조사)
- **전처리 도구**: Python 3.11, pandas, numpy, scikit-learn
- **ML 모델**: XGBoost, CatBoost, LightGBM
- **시각화**: matplotlib, seaborn
- **생성일**: 2025년 9월 11일
- **최종 업데이트**: 2025년 9월 11일 (부스팅 모델 실험 완료)
- **버전**: 2.0

---

*본 보고서는 개인의 임금과 직업만족도 예측을 위한 데이터 전처리 과정을 상세히 기록한 것입니다. 모든 전처리 코드와 결과물은 프로젝트 폴더에 체계적으로 정리되어 있습니다.*